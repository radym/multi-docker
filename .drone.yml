pipeline:
  build:
    image: plugins/docker
    commands:
      - docker build -t registry.gitlab.com/radym/multi-client ./client
      - docker build -t registry.gitlab.com/radym/multi-nginx ./nginx
      - docker build -t registry.gitlab.com/radym/multi-server ./server
      - docker build -t registry.gitlab.com/radym/multi-worker ./worker
      # Log in to the docker CLI
#      - echo "$DOCKER_PASSWORD" | docker login registry.gitlab.com -u "$DOCKER_ID" --password-stdin
      # Take images and push them to Docker Hub
#      - docker push registry.gitlab.com/radym/multi-client:latest
#      - docker push registry.gitlab.com/radym/multi-nginx:latest
#      - docker push registry.gitlab.com/radym/multi-server:latest
#      - docker push registry.gitlab.com/radym/multi-worker:latest
#    environment:
#      DOCKER_ID:
#        from_secrets: DOCKER_ID
#      DOCKER_PASSWORD:
#        from_secrets: DOCKER_PASSWORD
    when:
      branch: master
  publish:
    image: registry.gitlab.com/radym/multi-client
    image: registry.gitlab.com/radym/multi-nginx
    image: registry.gitlab.com/radym/multi-server
    image: registry.gitlab.com/radym/multi-worker
    repo: registry.gitlab.com
    username: DOCKER_ID
    password: DOCKER_PASSWORD
    environment:
      DOCKER_ID:
        from_secrets: DOCKER_ID
      DOCKER_PASSWORD:
        from_secrets: DOCKER_PASSWORD
    when:
      branch: master